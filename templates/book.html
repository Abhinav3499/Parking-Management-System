<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book a Parking Spot</title>
</head>
<body>
    <h2>Book Parking</h2>
    <a href="{{ url_for('user.dashboard') }}">Back to Dashboard</a>

    <form action="{{ url_for('user.book_parking') }}" method="post">
        <label for="location">Choose a Location:</label>
        <select id="location" name="location" required>
            <option value="">Choose a location...</option>
            {% for loc in locations %}
                <option value="{{ loc }}" {% if selected_location == loc %}selected{% endif %}>{{ loc }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Search Parking Lots">
    </form>
    <br>
    {% if parking_lots %}
        <h3>Available Lots at {{ selected_location }}</h3>
        <ul>
            {% for lot in parking_lots %}
                <li>
                    {{ lot.address }} (PIN: {{ lot.pin }}) - 
                    Spots Left: {{ lot.total_spots - (lot.status.filledCount if lot.status else 0) }} - 
                    Price: ${{ "%.2f"|format(lot.price) }}/hr
                    {% if lot.total_spots - (lot.status.filledCount if lot.status else 0) > 0 %}
                        <form action="{{ url_for('user.confirm_booking') }}" method="post" style="display:inline;">
                            <input type="hidden" name="lot_id" value="{{ lot.id }}">
                            <label for="vehicle_number_{{ lot.id }}">Vehicle Number:</label>
                            <input type="text" id="vehicle_number_{{ lot.id }}" name="vehicle_number" required>
                            <button type="submit">Book</button>
                        </form>
                    {% else %}
                        <span>Full</span>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    <a href="{{ url_for('auth.logout') }}">Logout</a>
</body>
</html>
